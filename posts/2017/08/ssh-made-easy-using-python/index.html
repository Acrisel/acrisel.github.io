<!DOCTYPE html>

<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
<title>SSH Made Easy Using Python Subprocess - Acrisel's Community Blog</title>
<!-- Using the latest rendering mode for IE -->
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<!-- https://developers.google.com/custom-search/docs/structured_data?hl=es&csw=1#microformats -->
<!--
<PageMap>
<DataObject type="document">
    <Attribute name="title">SSH Made Easy Using Python Subprocess</Attribute>
    <Attribute name="author">Arnon Sela</Attribute>
    <Attribute name="description">Subprocess Module Synopsis Python's subprocess module makes it easy to invoke external commands on localhost. It can also use SSH to invoke commands on remote hosts. How simple? The short answer is, very simple! The longer answer is, subprocess.run, as follows: 1 2 3 4 5result = subprocess.run …</Attribute>
    <Attribute name="page_count">1</Attribute>
    <Attribute name="rating">5</Attribute>
    <Attribute name="last_update">2017-08-22T23:12:44-05:00</Attribute>
</DataObject>
<DataObject type="metatags">
    <Attribute name="category" value="08"/>
        <Attribute name="category" value="Python"/>
        <Attribute name="category" value="SSH"/>
        <Attribute name="category" value="subprocess"/>
        <Attribute name="category" value="distributed"/>
        <Attribute name="category" value="cluster"/>
</DataObject>
-->
<link href="../../../../favicon.ico" rel="icon"/>
<link href="../../../../posts/2017/08/ssh-made-easy-using-python/" rel="canonical"/>
<meta content="Arnon Sela" name="author">
<meta content="Python,SSH,subprocess,distributed,cluster" name="keywords">
<meta content="Subprocess Module Synopsis Python's subprocess module makes it easy to invoke external commands on localhost. It can also use SSH to invoke commands on remote hosts. How simple? The short answer is, very simple! The longer answer is, subprocess.run, as follows: 1 2 3 4 5result = subprocess.run …" name="description">
<meta content="Acrisel's Community Blog" property="og:site_name"/>
<meta content="article" property="og:type"/>
<meta content="SSH Made Easy Using Python Subprocess" property="og:title"/>
<meta content="../../../../posts/2017/08/ssh-made-easy-using-python/" property="og:url"/>
<meta content="Subprocess Module Synopsis Python's subprocess module makes it easy to invoke external commands on localhost. It can also use SSH to invoke commands on remote hosts. How simple? The short answer is, very simple! The longer answer is, subprocess.run, as follows: 1 2 3 4 5result = subprocess.run …" property="og:description"/>
<meta content="2017-08-22" property="article:published_time"/>
<meta content="08" property="article:section"/>
<meta content="Python" property="article:tag"/>
<meta content="SSH" property="article:tag"/>
<meta content="subprocess" property="article:tag"/>
<meta content="distributed" property="article:tag"/>
<meta content="cluster" property="article:tag"/>
<meta content="Arnon Sela" property="article:author"/>
<!-- Bootstrap -->
<link href="../../../../theme/css/bootstrap.cerulean.min.css" rel="stylesheet" type="text/css">
<link href="../../../../theme/css/font-awesome.min.css" rel="stylesheet"/>
<link href="../../../../theme/css/pygments/xcode.css" rel="stylesheet"/>
<link href="../../../../theme/tipuesearch/tipuesearch.css" rel="stylesheet"/>
<link href="../../../../theme/css/html4css1.css" rel="stylesheet"/>
<link href="../../../../theme/css/style.css" rel="stylesheet" type="text/css">
</link></link></meta></meta></meta></head>
<body>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-ex1-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="../../../../">
Acrisel's Community Blog            </a>
</div>
<div class="collapse navbar-collapse navbar-ex1-collapse">
<ul class="nav navbar-nav">
<li><a href="../../../../pages/welcome-all.html">
</a></li>
<li>
<a href="../../../../category/about-us.html">About us</a>
</li>
<li>
<a href="../../../../category/11.html">11</a>
</li>
<li>
<a href="../../../../category/09.html">09</a>
</li>
<li class="active">
<a href="../../../../category/08.html">08</a>
</li>
<li>
<a href="../../../../category/07.html">07</a>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li><span>
<form action="/search.html" class="navbar-search">
<input class="search-query" id="tipue_search_input" name="q" placeholder="Search" required="" type="text"/>
</form></span>
</li>
</ul>
</div>
<!-- /.navbar-collapse -->
</div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
<div class="row">
<div class="col-sm-9">
<section id="content">
<article>
<header class="page-header">
<h1>
<a href="../../../../posts/2017/08/ssh-made-easy-using-python/" rel="bookmark" title="Permalink to SSH Made Easy Using Python Subprocess">
                        SSH Made Easy Using Python Subprocess
                    </a>
</h1>
</header>
<div class="entry-content">
<div class="panel">
<div class="panel-body">
<footer class="post-info">
<span class="label label-default">Date</span>
<span class="published">
<i class="fa fa-calendar"></i><time datetime="2017-08-22T23:12:44-05:00"> Tue 22 August 2017</time>
</span>
<span class="label label-default">Modified</span>
<span class="modified">
<i class="fa fa-calendar"></i><time datetime="2017-09-02T16:10:00-05:00"> Sat 02 September 2017</time>
</span>
<span class="label label-default">Tags</span>
<a href="../../../../tag/python.html">Python</a>
        /
	<a href="../../../../tag/ssh.html">SSH</a>
        /
	<a href="../../../../tag/subprocess.html">subprocess</a>
        /
	<a href="../../../../tag/distributed.html">distributed</a>
        /
	<a href="../../../../tag/cluster.html">cluster</a>
</footer><!-- /.post-info --> </div>
</div>
<div class="section" id="subprocess-module">
<h2>Subprocess Module</h2>
<div class="section" id="synopsis">
<h3>Synopsis</h3>
<p>Python's subprocess module makes it easy to invoke external commands on localhost.  It can also use SSH to invoke commands on remote hosts.</p>
</div>
<div class="section" id="how-simple">
<h3>How simple?</h3>
<p>The short answer is, very simple!</p>
<p>The longer answer is, subprocess.run, as follows:</p>
<blockquote>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">"ssh"</span><span class="p">,</span> <span class="s2">"some-host@some-user"</span><span class="p">,</span> <span class="s2">"some-command"</span><span class="p">],</span>
                        <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                        <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table></blockquote>
</div>
<div class="section" id="prerequisites">
<h3>Prerequisites</h3>
<p>For subprocess ssh-run to work, ssh configuration needs to be in place. This means that:</p>
<blockquote>
<ol class="arabic">
<li><p class="first">ssh-keygen on originating machine</p>
</li>
<li><p class="first">ssh-copy-id to the target machine into the target account's .ssh/authorized_keys</p>
</li>
<li><p class="first">optional: create .ssh/config for easier ssh call</p>
</li>
<li><p class="first">optional: use <em>command</em> in target .ssh/authorized_keys to allow proper setup, if needed, e.g:</p>
<blockquote>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">command</span><span class="o">=</span><span class="s2">"if [[ </span><span class="se">\"</span><span class="s2">x${SSH_ORIGINAL_COMMAND}x</span><span class="se">\"</span><span class="s2"> != </span><span class="se">\"</span><span class="s2">xx</span><span class="se">\"</span><span class="s2"> ]]; then source ~/.profile; eval </span><span class="se">\"</span><span class="s2">${SSH_ORIGINAL_COMMAND}</span><span class="se">\"</span><span class="s2">; else /bin/bash --login; fi;"</span> <span class="o">&lt;</span><span class="n">ssh_key</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></blockquote>
</li>
</ol>
</blockquote>
<p>Note that if you use bash, .profile may be .bash_profile. If you don't use bash, an appropriate shell profile should be sourced.</p>
</div>
<div class="section" id="wrapper">
<h3>Wrapper</h3>
<blockquote>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sshcmd</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">''' Runs ssh command via subprocess.  Assuming .ssh/config is configured.</span>

<span class="sd">    Args:</span>
<span class="sd">        host: target host to send the command to</span>
<span class="sd">        command: command to run on the host</span>
<span class="sd">        user: (optional) user to use to login to host</span>
<span class="sd">        stdin: (optional) override sys.stdin</span>
<span class="sd">        check: (optional) pass to *subprocess.run*; if set, checks return code</span>
<span class="sd">            and raises subprocess.CalledProcessError, if none-zero result</span>

<span class="sd">    Returns:</span>
<span class="sd">        subprocess.CompletedProcess object</span>
<span class="sd">    '''</span>

    <span class="n">where</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">host</span> <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">@</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">"ssh"</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">command</span><span class="p">],</span>
                           <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">stdin</span><span class="o">=</span><span class="n">stdin</span><span class="p">,</span>
                           <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                           <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                           <span class="n">check</span><span class="o">=</span><span class="n">check</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="c1"># will work on if you have a host named ubly with ssh configuration</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">sshcmd</span><span class="p">(</span><span class="s2">"ubly"</span><span class="p">,</span> <span class="s2">"ls -l"</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</pre></div>
</td></tr></table></blockquote>
<p>Note the following:</p>
<blockquote>
<ol class="arabic simple">
<li><em>check=True</em> would cause subprocess.run to through <em>subprocess.CalledProcessError</em>, if ssh exits with error code (greater than 0).</li>
<li>sshcmd returns <em>subprocess.CompletedProcess</em>; which gives full access to <em>PIPEs</em> and <em>return-code</em>.</li>
<li>stdout and stderr attributes are of binary form. Therefore result needs to be <em>decoded()</em>.</li>
</ol>
</blockquote>
</div>
</div>
</div>
<section class="well" id="post-share-links">
<h4>Share Post:</h4>
<p id="post-share-links">
<a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/&amp;title=SSH%20Made%20Easy%20Using%20Python%20Subprocess&amp;summary=Subprocess%20Module%0A%0ASynopsis%0APython%27s%20subprocess%20module%20makes%20it%20easy%20to%20invoke%20external%20commands%20on%20localhost.%20%20It%20can%20also%20use%20SSH%20to%20invoke%20commands%20on%20remote%20hosts.%0A%0A%0AHow%20simple%3F%0AThe%20short%20answer%20is%2C%20very%20simple%21%0AThe%20longer%20answer%20is%2C%20subprocess.run%2C%20as%20follows%3A%0A%0A1%0A2%0A3%0A4%0A5result%20%3D%20subprocess.run%20%E2%80%A6&amp;source=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Linkedin">Linkedin</a>
        ❄
        <a href="https://sharetodiaspora.github.io/?title=SSH%20Made%20Easy%20Using%20Python%20Subprocess&amp;url=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Diaspora">Diaspora*</a>
        ❄
        <a href="https://twitter.com/intent/tweet?text=SSH%20Made%20Easy%20Using%20Python%20Subprocess&amp;url=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Twitter">Twitter</a>
        ❄
        <a href="http://www.facebook.com/sharer/sharer.php?u=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Facebook">Facebook</a>
        ❄
        <a href="https://plus.google.com/share?url=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Google Plus">Google+</a>
        ❄
        <a href="mailto:?subject=SSH%20Made%20Easy%20Using%20Python%20Subprocess&amp;body=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share via Email">Email</a>
</p>
<!--
    <ul>
    <li><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/&title=SSH%20Made%20Easy%20Using%20Python%20Subprocess&summary=Subprocess%20Module%0A%0ASynopsis%0APython%27s%20subprocess%20module%20makes%20it%20easy%20to%20invoke%20external%20commands%20on%20localhost.%20%20It%20can%20also%20use%20SSH%20to%20invoke%20commands%20on%20remote%20hosts.%0A%0A%0AHow%20simple%3F%0AThe%20short%20answer%20is%2C%20very%20simple%21%0AThe%20longer%20answer%20is%2C%20subprocess.run%2C%20as%20follows%3A%0A%0A1%0A2%0A3%0A4%0A5result%20%3D%20subprocess.run%20%E2%80%A6&source=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Diaspora">linkedin*</a></li>
    <li><a href="https://sharetodiaspora.github.io/?title=SSH%20Made%20Easy%20Using%20Python%20Subprocess&url=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Diaspora">Diaspora*</a></li>
    <li><a href="https://twitter.com/intent/tweet?text=SSH%20Made%20Easy%20Using%20Python%20Subprocess&url=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Twitter">Twitter</a></li>
    <li><a href="http://www.facebook.com/sharer/sharer.php?u=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://plus.google.com/share?url=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share on Google Plus">Google+</a></li>
    <li><a href="mailto:?subject=SSH%20Made%20Easy%20Using%20Python%20Subprocess&amp;body=https%3A//acrisel.github.io/posts/2017/08/ssh-made-easy-using-python/" target="_blank" title="Share via Email">Email</a></li>
    </ul
    -->
</section>
<!-- /.entry-content -->
<section class="well" id="related-posts">
<h4>Other Posts:</h4>
<ul>
<li><a href="../../../../posts/2017/09/ssh-pipe-with-python-subprocess/">SSH Pipe with Python's Subprocess</a></li>
<li><a href="../../../../posts/2017/09/ssh-pipe-with-python-subprocess_multiprocessing/">SSH Pipe with Python's Subprocess and Multiprocessing</a></li>
<li><a href="../../../../posts/2017/09/python-check-remote-host-accessibility/">Remote Host Accessibility</a></li>
<li><a href="../../../../posts/2017/08/python-ordered-class/">Python Ordered Class</a></li>
<li><a href="../../../../posts/2017/07/cobol-conversion-take-1/">Cobol Conversion Take 1</a></li>
</ul>
</section>
<a href="https://plus.google.com/111013214708506107651??rel=author"> </a>
<style>
#pcs-comment-form input,
#pcs-comment-form textarea {
	width: 100%;
}
#pcs-comment-form-display-replyto {
	border: solid 1px black;
	padding: 2px;
}
#pcs-comment-form-display-replyto p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}
#pcs-comments ul {
	list-style: none;
}
#pcs-comments .comment-left {
	display: table-cell;
	padding-right: 10px;
}
#pcs-comments .comment-body {
	display: table-cell;
	vertical-align: top;
	width: 100%;
}
</style>
<section id="pcs-comments">
<header>
<h2>Comments</h2>
<hr/>
</header>
<p>There are no comments yet.</p>
<section>
<form action="#" id="pcs-comment-form">
<legend>Add a Comment</legend>
<input id="pcs-comment-form-input-replyto" type="hidden"/>
<fieldset>
<label for="pcs-comment-form-input-name">Name</label>
<input id="pcs-comment-form-input-name" placeholder="Enter your name or nickname" type="text">
</input></fieldset>
<fieldset>
<label for="pcs-comment-form-input-website">Website</label>
<input id="pcs-comment-form-input-website" placeholder="Enter your website (optional)" type="text">
</input></fieldset>
<fieldset>
<label for="pcs-comment-form-input-textarea">Your Comment</label>
<textarea id="pcs-comment-form-input-textarea" placeholder="Your comment" rows="5" style="resize:vertical;"></textarea>
<p>You can use the <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> syntax to format your comment.</p>
<div id="pcs-comment-form-display-replyto" style="display: none; "></div>
</fieldset>
<button id="pcs-comment-form-button-submit" type="submit">Post via email</button>
<!--
			<a href="../../../../feeds/comment.ssh-made-easy-using-python.atom.xml">
				Comment Atom Feed
			</a>
        -->
</form>
</section>
</section>
<script src="../../../../theme/js/comments.js" type="text/javascript"></script>
<script type="text/javascript">
		$(document).ready(function() {
			CommentSystem.email_user   = "support";
			CommentSystem.email_domain = "acrisel.com";
			CommentSystem.display_replyto_html = function(comment_content, article_slug, author) {
				return ''
					+ '<button style="float:right;" onclick="CommentSystem.cancelReply(); return false;" title="Cancel the reply">'
					+ 	'×'
					+ '</button>'
					+ '<p>This comment will be posted as a reply to \'<a title="'+comment_content+'" href="#comment-'+article_slug+'">'+author+'</a>\'</p>';
			};

			$('#pcs-comment-form').on("submit",
				function( event )
				{
					event.preventDefault();
					$(location).attr('href', CommentSystem.getMailtoLink("ssh-made-easy-using-python"));
				}
			);
		});
	</script>
</article>
</section>
</div>
<div class="col-sm-3" id="sidebar">
<aside>
<!-- Sidebar -->
<section class="well well-sm">
<ul class="list-group list-group-flush">
<!-- Sidebar/Links -->
<li class="list-group-item">
<h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
<ul class="list-group" id="links">
<li class="list-group-item">
<a href="http://www.acrisel.com/" target="_blank">Acrisel</a>
</li>
<li class="list-group-item">
<a href="http://www.github.com/acrisel" target="_blank">Acrisel Open Source</a>
</li>
<li class="list-group-item">
<a href="http://getpelican.com/" target="_blank">Pelican</a>
</li>
<li class="list-group-item">
<a href="http://python.org/" target="_blank">Python.org</a>
</li>
<li class="list-group-item">
<a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a>
</li>
</ul>
</li>
<!-- End Sidebar/Links -->
</ul>
</section>
<!-- End Sidebar --> </aside>
</div>
</div>
</div>
<footer>
<div class="container">
<hr/>
<div class="row">
<div class="col-xs-10">© 2017 Acrisel Team
            · Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a> </div>
<div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
</div>
</div>
</footer>
<script src="../../../../theme/js/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../../../theme/js/bootstrap.min.js"></script>
<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../../../../theme/js/respond.min.js"></script>
</body>
</html>